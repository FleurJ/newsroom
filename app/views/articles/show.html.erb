<div class="container">
  <div class="row">
  <!--  <%= link_to "Article suivant >", next_article_path %> -->
    <div class="col md-11">
    <div class="card article-show">
      <div class="card-header">
        <div class="row justify-content-between">
        <!-- === BROUILLON === -->
          <div class="col-md-11">
            <% if @article.status == "draft" %>
              <div class="draftflag article-show">Brouillon</div>
            <% end %>
          </div>

        <!-- === FAVOURITE FLAG  -->
           <div class="action-star-title col-md-1">
            <% if current_user.favorites.include? @article %>
              <%= link_to favorite_article_path(@article, type: "unfavorite"), method: :put do %>
                <i class="fas fa-star"></i>
              <% end %>
            <% else %>
              <%= link_to favorite_article_path(@article, type: "favorite"), method: :put do %>
                <i class="far fa-star"></i>
              <% end %>
            <% end %>
            </div>
         </div>

      <!-- === ARTICLE TITLE & SOURCE === -->
        <h1> <%= @article.title %></h1>
        <div class="rainbow"></div> <!-- affiche la ligne de séparation -->
        <% if @article.article_type == "presse" %>
          <p><%= @article.source_url.html_safe %> <%= @article.source_name %>, le <%= @article.publication_date.strftime("%d.%m.%Y") %> </p>
        <% elsif @article.article_type == "belga" %>
          <p><%= @article.source_name %>, le <%= @article.publication_date.strftime("%d.%m.%Y") %> </p>
        <% else %>
          <p><%= @article.source_name %>, <%= @article.source_url %>, le <%= @article.publication_date.strftime("%d.%m.%Y") %> </p>
      <% end %>
      </div>

    <!-- === BODY -->
      <div class="card-body">
        <p><%= simple_format(@article.body.html_safe) %></p>
        <% @tags.each do |t| %>
          <%= link_to t.name, tag_path(t), class: "btn btn-tag" %>
      <% end %>
      </div>

    <!-- ARTICLE FOOTER -->
      <div class="card-footer text-muted">
        <p>Ajouté le <%= @article.publication_date.strftime("%d.%m.%Y") %> par <%= @article.user.first_name %> <%=@article.user.name %></p>
      </div>

    </div>

    <!-- ACTIONS -->
    <% if @article.user == current_user || current_user.role != "user" %>
      <div class="row article-actions">
            <%= link_to "Modifier", edit_article_path(@article), class:"btn btn-primary" %> &nbsp;
            <%= button_to "Supprimer", article_path(@article),
                            method: :delete,
                            data: { confirm: "Veuillez confirmer la suppression !" },
                           :id => "delete", class:"btn btn-danger" %>

      </div>
    <% end %>

    <!-- COMMENTS -->
  <div>
    <% if @comments.empty? == false %>
      <p><%= @comments.count %> commentaire(s)</p>
        <% @comments.each do |c| %>
        <div class ="card article-show">
          <p style="padding-left: 16px;"><%= c.body %></p>
          <hr>
            <div class="row pl-3">
              <div class="text-muted">
              <small>
                <b><%= c.user.first_name %> <%= c.user.name %></b>, le <%= c.created_at.strftime("%d.%m.%Y %k:%M") %>
                <% if @article.user == current_user || current_user.role == 'admin' %>
                  <%= link_to "Modifier", method: :get, params: { state: "edit" } %> -
                  <%= link_to "Supprimer", article_comment_path(id: c.id, article_id: @article.id), method: :delete %>
            </small>
           </div>
          </div>
          <% end %>
        </div>

          <% if @state == "edit" %>
            <%= simple_form_for([@article, c]) do |f| %>
              <%= f.input :body %>
            <%= f.submit "Sauvegarder" %>
            <% end %>
          <% end %>
        <% end %>
    <% end %>

      <%= render "comments/new", article: @article, comment: @article.comments.build %>
  </div>

  </div>
  </div>
</div>
